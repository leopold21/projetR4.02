<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimulateurReusine.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SimulateurImpot2024</a> &gt; <a href="index.source.html" class="el_package">com.kerware.simulateurreusine</a> &gt; <span class="el_source">SimulateurReusine.java</span></div><h1>SimulateurReusine.java</h1><pre class="source lang-java linenums">package com.kerware.simulateurreusine;

import com.kerware.simulateur.SituationFamiliale;

// Version réusinée du Simulateur, adaptée pour une meilleure modularité et lisibilité
<span class="fc" id="L6">public class SimulateurReusine {</span>


    // Les limites des tranches de revenus imposables
<span class="fc" id="L10">    private int l00 = 0 ;</span>
<span class="fc" id="L11">    private int l01 = 11294;</span>
<span class="fc" id="L12">    private int l02 = 28797;</span>
<span class="fc" id="L13">    private int l03 = 82341;</span>
<span class="fc" id="L14">    private int l04 = 177106;</span>
<span class="fc" id="L15">    private int l05 = Integer.MAX_VALUE;</span>

<span class="fc" id="L17">    private int[] limites = new int[6];</span>

    // Les taux d'imposition par tranche
<span class="fc" id="L20">    private double t00 = 0.0;</span>
<span class="fc" id="L21">    private double t01 = 0.11;</span>
<span class="fc" id="L22">    private double t02 = 0.3;</span>
<span class="fc" id="L23">    private double t03 = 0.41;</span>
<span class="fc" id="L24">    private double t04 = 0.45;</span>

<span class="fc" id="L26">    private double[] taux = new double[5];</span>

    // Les limites des tranches pour la contribution exceptionnelle sur les hauts revenus
<span class="fc" id="L29">    private int lce00 = 0;</span>
<span class="fc" id="L30">    private int lce01 = 250000;</span>
<span class="fc" id="L31">    private int lce02 = 500000;</span>
<span class="fc" id="L32">    private int lce03 = 1000000;</span>
<span class="fc" id="L33">    private int lce04 = Integer.MAX_VALUE;</span>

<span class="fc" id="L35">    private int[] limitesCEHR = new int[5];</span>

    // Les taux de la contribution exceptionnelle sur les hauts revenus pour les celibataires
<span class="fc" id="L38">    private double tce00 = 0.0;</span>
<span class="fc" id="L39">    private double tce01 = 0.03;</span>
<span class="fc" id="L40">    private double tce02 = 0.04;</span>
<span class="fc" id="L41">    private double tce03 = 0.04;</span>

<span class="fc" id="L43">    private double[] tauxCEHRCelibataire = new double[4];</span>

    // Les taux de la contribution exceptionnelle sur les hauts revenus pour les couples
<span class="fc" id="L46">    private double tce00C = 0.0;</span>
<span class="fc" id="L47">    private double tce01C = 0.0;</span>
<span class="fc" id="L48">    private double tce02C = 0.03;</span>
<span class="fc" id="L49">    private double tce03C = 0.04;</span>

<span class="fc" id="L51">    private double[] tauxCEHRCouple = new double[4];</span>

    // Abattement
<span class="fc" id="L54">    private  int lAbtMax = 14171;</span>
<span class="fc" id="L55">    private  int lAbtMin = 495;</span>
<span class="fc" id="L56">    private double tAbt = 0.1;</span>

    // Plafond de baisse maximal par demi part
<span class="fc" id="L59">    private double plafDemiPart = 1759;</span>

<span class="fc" id="L61">    private double seuilDecoteDeclarantSeul = 1929;</span>
<span class="fc" id="L62">    private double seuilDecoteDeclarantCouple    = 3191;</span>

<span class="fc" id="L64">    private double decoteMaxDeclarantSeul = 873;</span>
<span class="fc" id="L65">    private double decoteMaxDeclarantCouple = 1444;</span>
<span class="fc" id="L66">    private double tauxDecote = 0.4525;</span>

    // revenu net
<span class="fc" id="L69">    private int rNetDecl1 = 0;</span>
<span class="fc" id="L70">    private int rNetDecl2 = 0;</span>
    // nb enfants
<span class="fc" id="L72">    private int nbEnf = 0;</span>
    // nb enfants handicapés
<span class="fc" id="L74">    private int nbEnfH = 0;</span>

    // revenu fiscal de référence
<span class="fc" id="L77">    private double rFRef = 0;</span>

    // revenu imposable
<span class="fc" id="L80">    private double rImposable = 0;</span>

    // abattement
<span class="fc" id="L83">    private double abt = 0;</span>

    // nombre de parts des  déclarants
<span class="fc" id="L86">    private double nbPtsDecl = 0;</span>
    // nombre de parts du foyer fiscal
<span class="fc" id="L88">    private double nbPts = 0;</span>

    // decote
<span class="fc" id="L91">    private double decote = 0;</span>
    // impôt des déclarants
<span class="fc" id="L93">    private double mImpDecl = 0;</span>
    // impôt du foyer fiscal
<span class="fc" id="L95">    private double mImp = 0;</span>
<span class="fc" id="L96">    private double mImpAvantDecote = 0;</span>
    // parent isolé
<span class="fc" id="L98">    private boolean parIso = false;</span>
    // Contribution exceptionnelle sur les hauts revenus
<span class="fc" id="L100">    private double contribExceptionnelle = 0;</span>

    // Getters pour adapter le code legacy pour les tests unitaires

    public double getRevenuReference() {
<span class="nc" id="L105">        return rFRef;</span>
    }

    public double getDecote() {
<span class="nc" id="L109">        return decote;</span>
    }


    public double getAbattement() {
<span class="fc" id="L114">        return abt;</span>
    }

    public double getNbParts() {
<span class="fc" id="L118">        return nbPts;</span>
    }

    public double getImpotAvantDecote() {
<span class="nc" id="L122">        return mImpAvantDecote;</span>
    }

    public double getImpotNet() {
<span class="fc" id="L126">        return mImp;</span>
    }

    public int getRevenuNetDeclatant1() {
<span class="nc" id="L130">        return rNetDecl1;</span>
    }

    public int getRevenuNetDeclatant2() {
<span class="nc" id="L134">        return rNetDecl2;</span>
    }

    public double getContribExceptionnelle() {
<span class="nc" id="L138">        return contribExceptionnelle;</span>
    }


    // Fonction de calcul de l'impôt sur le revenu net en France en 2024 sur les revenu 2023

    public int calculImpot(int revNetDecl1, int revNetDecl2, SituationFamiliale sitFam, int nbEnfants, int nbEnfantsHandicapes, boolean parentIsol) {

        // Préconditions
<span class="pc bpc" id="L147" title="1 of 4 branches missed.">        if ( revNetDecl1  &lt; 0 || revNetDecl2 &lt; 0 ) {</span>
<span class="fc" id="L148">            throw new IllegalArgumentException(&quot;Le revenu net ne peut pas être négatif&quot;);</span>
        }

<span class="fc bfc" id="L151" title="All 2 branches covered.">        if ( nbEnfants &lt; 0 ) {</span>
<span class="fc" id="L152">            throw new IllegalArgumentException(&quot;Le nombre d'enfants ne peut pas être négatif&quot;);</span>
        }

<span class="fc bfc" id="L155" title="All 2 branches covered.">        if ( nbEnfantsHandicapes &lt; 0 ) {</span>
<span class="fc" id="L156">            throw new IllegalArgumentException(&quot;Le nombre d'enfants handicapés ne peut pas être négatif&quot;);</span>
        }

<span class="fc bfc" id="L159" title="All 2 branches covered.">        if ( sitFam == null ) {</span>
<span class="fc" id="L160">            throw new IllegalArgumentException(&quot;La situation familiale ne peut pas être null&quot;);</span>
        }

<span class="fc bfc" id="L163" title="All 2 branches covered.">        if ( nbEnfantsHandicapes &gt; nbEnfants ) {</span>
<span class="fc" id="L164">            throw new IllegalArgumentException(&quot;Le nombre d'enfants handicapés ne peut pas être supérieur au nombre d'enfants&quot;);</span>
        }

<span class="fc bfc" id="L167" title="All 2 branches covered.">        if ( nbEnfants &gt; 7 ) {</span>
<span class="fc" id="L168">            throw new IllegalArgumentException(&quot;Le nombre d'enfants ne peut pas être supérieur à 7&quot;);</span>
        }

<span class="fc bfc" id="L171" title="All 6 branches covered.">        if ( parentIsol &amp;&amp; ( sitFam == SituationFamiliale.MARIE || sitFam == SituationFamiliale.PACSE ) ) {</span>
<span class="fc" id="L172">            throw new IllegalArgumentException(&quot;Un parent isolé ne peut pas être marié ou pacsé&quot;);</span>
        }

<span class="fc bfc" id="L175" title="All 6 branches covered.">        boolean seul = sitFam == SituationFamiliale.CELIBATAIRE || sitFam == SituationFamiliale.DIVORCE || sitFam == SituationFamiliale.VEUF;</span>
<span class="pc bpc" id="L176" title="1 of 4 branches missed.">        if (  seul &amp;&amp; revNetDecl2 &gt; 0 ) {</span>
<span class="nc" id="L177">            throw new IllegalArgumentException(&quot;Un célibataire, un divorcé ou un veuf ne peut pas avoir de revenu pour le déclarant 2&quot;);</span>
        }

        // Initialisation des variables

<span class="fc" id="L182">        rNetDecl1 = revNetDecl1;</span>
<span class="fc" id="L183">        rNetDecl2 = revNetDecl2;</span>

<span class="fc" id="L185">        nbEnf = nbEnfants;</span>
<span class="fc" id="L186">        nbEnfH = nbEnfantsHandicapes;</span>
<span class="fc" id="L187">        parIso = parentIsol;</span>

<span class="fc" id="L189">        limites[0] = l00;</span>
<span class="fc" id="L190">        limites[1] = l01;</span>
<span class="fc" id="L191">        limites[2] = l02;</span>
<span class="fc" id="L192">        limites[3] = l03;</span>
<span class="fc" id="L193">        limites[4] = l04;</span>
<span class="fc" id="L194">        limites[5] = l05;</span>

<span class="fc" id="L196">        taux[0] = t00;</span>
<span class="fc" id="L197">        taux[1] = t01;</span>
<span class="fc" id="L198">        taux[2] = t02;</span>
<span class="fc" id="L199">        taux[3] = t03;</span>
<span class="fc" id="L200">        taux[4] = t04;</span>

<span class="fc" id="L202">        limitesCEHR[0] = lce00;</span>
<span class="fc" id="L203">        limitesCEHR[1] = lce01;</span>
<span class="fc" id="L204">        limitesCEHR[2] = lce02;</span>
<span class="fc" id="L205">        limitesCEHR[3] = lce03;</span>
<span class="fc" id="L206">        limitesCEHR[4] = lce04;</span>

<span class="fc" id="L208">        tauxCEHRCelibataire[0] = tce00;</span>
<span class="fc" id="L209">        tauxCEHRCelibataire[1] = tce01;</span>
<span class="fc" id="L210">        tauxCEHRCelibataire[2] = tce02;</span>
<span class="fc" id="L211">        tauxCEHRCelibataire[3] = tce03;</span>

<span class="fc" id="L213">        tauxCEHRCouple[0] = tce00C;</span>
<span class="fc" id="L214">        tauxCEHRCouple[1] = tce01C;</span>
<span class="fc" id="L215">        tauxCEHRCouple[2] = tce02C;</span>
<span class="fc" id="L216">        tauxCEHRCouple[3] = tce03C;</span>

<span class="fc" id="L218">        System.out.println(&quot;--------------------------------------------------&quot;);</span>
<span class="fc" id="L219">        System.out.println( &quot;Revenu net declarant1 : &quot; + rNetDecl1 );</span>
<span class="fc" id="L220">        System.out.println( &quot;Revenu net declarant2 : &quot; + rNetDecl2 );</span>
<span class="fc" id="L221">        System.out.println( &quot;Situation familiale : &quot; + sitFam.name() );</span>

        // Abattement
        // EXIGENCE : EXG_IMPOT_02
<span class="fc" id="L225">        long abt1 = Math.round(rNetDecl1 * tAbt);</span>
<span class="fc" id="L226">        long abt2 = Math.round(rNetDecl2 * tAbt);</span>

<span class="fc bfc" id="L228" title="All 2 branches covered.">        if (abt1 &gt; lAbtMax) {</span>
<span class="fc" id="L229">            abt1 = lAbtMax;</span>
        }
<span class="fc bfc" id="L231" title="All 4 branches covered.">        if ( sitFam == SituationFamiliale.MARIE || sitFam == SituationFamiliale.PACSE ) {</span>
<span class="fc bfc" id="L232" title="All 2 branches covered.">            if (abt2 &gt; lAbtMax) {</span>
<span class="fc" id="L233">                abt2 = lAbtMax;</span>
            }
        }

<span class="fc bfc" id="L237" title="All 2 branches covered.">        if (abt1 &lt; lAbtMin) {</span>
<span class="fc" id="L238">            abt1 = lAbtMin;</span>
        }

<span class="fc bfc" id="L241" title="All 4 branches covered.">        if ( sitFam == SituationFamiliale.MARIE || sitFam == SituationFamiliale.PACSE ) {</span>
<span class="fc bfc" id="L242" title="All 2 branches covered.">            if (abt2 &lt; lAbtMin) {</span>
<span class="fc" id="L243">                abt2 = lAbtMin;</span>
            }
        }

<span class="fc" id="L247">        abt = abt1 + abt2;</span>
<span class="fc" id="L248">        System.out.println( &quot;Abattement : &quot; + abt );</span>

<span class="fc" id="L250">        rFRef = rNetDecl1 + revNetDecl2 - abt;</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">        if ( rFRef &lt; 0 ) {</span>
<span class="fc" id="L252">            rFRef = 0;</span>
        }

<span class="fc" id="L255">        System.out.println( &quot;Revenu fiscal de référence : &quot; + rFRef );</span>


        // parts déclarants
        // EXIG  : EXG_IMPOT_03
<span class="pc bpc" id="L260" title="1 of 6 branches missed.">        switch ( sitFam ) {</span>
            case CELIBATAIRE:
<span class="fc" id="L262">                nbPtsDecl = 1;</span>
<span class="fc" id="L263">                break;</span>
            case MARIE:
<span class="fc" id="L265">                nbPtsDecl = 2;</span>
<span class="fc" id="L266">                break;</span>
            case DIVORCE:
<span class="fc" id="L268">                nbPtsDecl = 1;</span>
<span class="fc" id="L269">                break;</span>
            case VEUF:
<span class="fc" id="L271">                nbPtsDecl = 1;</span>
<span class="fc" id="L272">                break;</span>
            case PACSE:
<span class="fc" id="L274">                nbPtsDecl = 2;</span>
                break;
        }

<span class="fc" id="L278">        System.out.println( &quot;Nombre d'enfants  : &quot; + nbEnf );</span>
<span class="fc" id="L279">        System.out.println( &quot;Nombre d'enfants handicapés : &quot; + nbEnfH );</span>

        // parts enfants à charge
<span class="fc bfc" id="L282" title="All 2 branches covered.">        if ( nbEnf &lt;= 2 ) {</span>
<span class="fc" id="L283">            nbPts = nbPtsDecl + nbEnf * 0.5;</span>
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">        } else if ( nbEnf &gt; 2 ) {</span>
<span class="fc" id="L285">            nbPts = nbPtsDecl+  1.0 + ( nbEnf - 2 );</span>
        }

        // parent isolé

<span class="fc" id="L290">        System.out.println( &quot;Parent isolé : &quot; + parIso );</span>

<span class="fc bfc" id="L292" title="All 2 branches covered.">        if ( parIso ) {</span>
<span class="pc bpc" id="L293" title="1 of 2 branches missed.">            if ( nbEnf &gt; 0 ){</span>
<span class="fc" id="L294">                nbPts = nbPts + 0.5;</span>
            }
        }

        // Veuf avec enfant
<span class="pc bpc" id="L299" title="1 of 4 branches missed.">        if ( sitFam == SituationFamiliale.VEUF &amp;&amp; nbEnf &gt; 0 ) {</span>
<span class="fc" id="L300">            nbPts = nbPts + 1;</span>
        }

        // enfant handicapé
<span class="fc" id="L304">        nbPts = nbPts + nbEnfH * 0.5;</span>

<span class="fc" id="L306">        System.out.println( &quot;Nombre de parts : &quot; + nbPts );</span>

        // EXIGENCE : EXG_IMPOT_07:
        // Contribution exceptionnelle sur les hauts revenus
<span class="fc" id="L310">        contribExceptionnelle = 0;</span>
<span class="fc" id="L311">        int i = 0;</span>
        do {
<span class="pc bpc" id="L313" title="1 of 4 branches missed.">            if ( rFRef &gt;= limitesCEHR[i] &amp;&amp; rFRef &lt; limitesCEHR[i+1] ) {</span>
<span class="fc bfc" id="L314" title="All 2 branches covered.">                if ( nbPtsDecl == 1 ) {</span>
<span class="fc" id="L315">                    contribExceptionnelle += ( rFRef - limitesCEHR[i] ) * tauxCEHRCelibataire[i];</span>
                } else {
<span class="fc" id="L317">                    contribExceptionnelle += ( rFRef - limitesCEHR[i] ) * tauxCEHRCouple[i];</span>
                }
<span class="fc" id="L319">                break;</span>
            } else {
<span class="fc bfc" id="L321" title="All 2 branches covered.">                if ( nbPtsDecl == 1 ) {</span>
<span class="fc" id="L322">                    contribExceptionnelle += ( limitesCEHR[i+1] - limitesCEHR[i] ) * tauxCEHRCelibataire[i];</span>
                } else {
<span class="fc" id="L324">                    contribExceptionnelle += ( limitesCEHR[i+1] - limitesCEHR[i] ) * tauxCEHRCouple[i];</span>
                }
            }
<span class="fc" id="L327">            i++;</span>
<span class="pc bpc" id="L328" title="1 of 2 branches missed.">        } while( i &lt; 5);</span>

<span class="fc" id="L330">        contribExceptionnelle = Math.round( contribExceptionnelle );</span>
<span class="fc" id="L331">        System.out.println( &quot;Contribution exceptionnelle sur les hauts revenus : &quot; + contribExceptionnelle );</span>

        // Calcul impôt des declarants
        // EXIGENCE : EXG_IMPOT_04
<span class="fc" id="L335">        rImposable = rFRef / nbPtsDecl ;</span>

<span class="fc" id="L337">        mImpDecl = 0;</span>

<span class="fc" id="L339">        i = 0;</span>
        do {
<span class="pc bpc" id="L341" title="1 of 4 branches missed.">            if ( rImposable &gt;= limites[i] &amp;&amp; rImposable &lt; limites[i+1] ) {</span>
<span class="fc" id="L342">                mImpDecl += ( rImposable - limites[i] ) * taux[i];</span>
<span class="fc" id="L343">                break;</span>
            } else {
<span class="fc" id="L345">                mImpDecl += ( limites[i+1] - limites[i] ) * taux[i];</span>
            }
<span class="fc" id="L347">            i++;</span>
<span class="pc bpc" id="L348" title="1 of 2 branches missed.">        } while( i &lt; 5);</span>

<span class="fc" id="L350">        mImpDecl = mImpDecl * nbPtsDecl;</span>
<span class="fc" id="L351">        mImpDecl = Math.round( mImpDecl );</span>

<span class="fc" id="L353">        System.out.println( &quot;Impôt brut des déclarants : &quot; + mImpDecl );</span>

        // Calcul impôt foyer fiscal complet
        // EXIGENCE : EXG_IMPOT_04
<span class="fc" id="L357">        rImposable =  rFRef / nbPts;</span>
<span class="fc" id="L358">        mImp = 0;</span>
<span class="fc" id="L359">        i = 0;</span>

        do {
<span class="pc bpc" id="L362" title="1 of 4 branches missed.">            if ( rImposable &gt;= limites[i] &amp;&amp; rImposable &lt; limites[i+1] ) {</span>
<span class="fc" id="L363">                mImp += ( rImposable - limites[i] ) * taux[i];</span>
<span class="fc" id="L364">                break;</span>
            } else {
<span class="fc" id="L366">                mImp += ( limites[i+1] - limites[i] ) * taux[i];</span>
            }
<span class="fc" id="L368">            i++;</span>
<span class="pc bpc" id="L369" title="1 of 2 branches missed.">        } while( i &lt; 5);</span>

<span class="fc" id="L371">        mImp = mImp * nbPts;</span>
<span class="fc" id="L372">        mImp = Math.round( mImp );</span>

<span class="fc" id="L374">        System.out.println( &quot;Impôt brut du foyer fiscal complet : &quot; + mImp );</span>

        // Vérification de la baisse d'impôt autorisée
        // EXIGENCE : EXG_IMPOT_05
        // baisse impot

<span class="fc" id="L380">        double baisseImpot = mImpDecl - mImp;</span>

<span class="fc" id="L382">        System.out.println( &quot;Baisse d'impôt : &quot; + baisseImpot );</span>

        // dépassement plafond
<span class="fc" id="L385">        double ecartPts = nbPts - nbPtsDecl;</span>

<span class="fc" id="L387">        double plafond = (ecartPts / 0.5) * plafDemiPart;</span>

<span class="fc" id="L389">        System.out.println( &quot;Plafond de baisse autorisée &quot; + plafond );</span>

<span class="fc bfc" id="L391" title="All 2 branches covered.">        if ( baisseImpot &gt;= plafond ) {</span>
<span class="fc" id="L392">            mImp = mImpDecl - plafond;</span>
        }

<span class="fc" id="L395">        System.out.println( &quot;Impôt brut après plafonnement avant decote : &quot; + mImp );</span>
<span class="fc" id="L396">        mImpAvantDecote = mImp;</span>

        // Calcul de la decote
        // EXIGENCE : EXG_IMPOT_06

<span class="fc" id="L401">        decote = 0;</span>
        // decote
<span class="fc bfc" id="L403" title="All 2 branches covered.">        if ( nbPtsDecl == 1 ) {</span>
<span class="fc bfc" id="L404" title="All 2 branches covered.">            if ( mImp &lt; seuilDecoteDeclarantSeul ) {</span>
<span class="fc" id="L405">                decote = decoteMaxDeclarantSeul - ( mImp  * tauxDecote );</span>
            }
        }
<span class="fc bfc" id="L408" title="All 2 branches covered.">        if (  nbPtsDecl == 2 ) {</span>
<span class="fc bfc" id="L409" title="All 2 branches covered.">            if ( mImp &lt; seuilDecoteDeclarantCouple ) {</span>
<span class="fc" id="L410">                decote =  decoteMaxDeclarantCouple - ( mImp  * tauxDecote  );</span>
            }
        }
<span class="fc" id="L413">        decote = Math.round( decote );</span>

<span class="fc bfc" id="L415" title="All 2 branches covered.">        if ( mImp &lt;= decote ) {</span>
<span class="fc" id="L416">            decote = mImp;</span>
        }

<span class="fc" id="L419">        System.out.println( &quot;Decote : &quot; + decote );</span>

<span class="fc" id="L421">        mImp = mImp - decote;</span>

<span class="fc" id="L423">        mImp += contribExceptionnelle;</span>

<span class="fc" id="L425">        mImp = Math.round( mImp );</span>

<span class="fc" id="L427">        System.out.println( &quot;Impôt sur le revenu net final : &quot; + mImp );</span>
<span class="fc" id="L428">        return  (int)mImp;</span>
    }





}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>
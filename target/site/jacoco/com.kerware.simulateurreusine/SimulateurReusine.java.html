<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimulateurReusine.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SimulateurImpot2024</a> &gt; <a href="index.source.html" class="el_package">com.kerware.simulateurreusine</a> &gt; <span class="el_source">SimulateurReusine.java</span></div><h1>SimulateurReusine.java</h1><pre class="source lang-java linenums">package com.kerware.simulateurreusine;

import com.kerware.simulateur.SituationFamiliale;
import com.kerware.simulateurreusine.calcul.Abattement;
import com.kerware.simulateurreusine.calcul.Decote;
import com.kerware.simulateurreusine.calcul.Impot;
import com.kerware.simulateurreusine.calcul.PartsFiscales;
import com.kerware.simulateurreusine.calcul.PlafonneurAvantageFiscal;
import com.kerware.simulateurreusine.calcul.Revenu;
import com.kerware.simulateurreusine.calcul.VerificateurDonneesFiscales;
import com.kerware.simulateurreusine.calcul.ContributionExceptionnelle;
import com.kerware.simulateurreusine.outils.ConstantesFiscales;


// Version réusinée du Simulateur, adaptée pour une meilleure modularité et lisibilité
<span class="fc" id="L16">public final class SimulateurReusine {</span>

    // revenu net
<span class="fc" id="L19">    private int revenuNetDeclarant1 = 0;</span>
<span class="fc" id="L20">    private int revenuNetDeclarant2 = 0;</span>
    // nb enfants
<span class="fc" id="L22">    private int nbEnfants = 0;</span>
    // nb enfants handicapés
<span class="fc" id="L24">    private int nbEnfantsHandicapes = 0;</span>

    // revenu fiscal de référence
<span class="fc" id="L27">    private double revenuFiscalReference = 0;</span>

    // abattement
<span class="fc" id="L30">    private double abattement = 0;</span>

    // nombre de parts des  déclarants
<span class="fc" id="L33">    private double nbPartsDeclarants = 0;</span>
    // nombre de parts du foyer fiscal
<span class="fc" id="L35">    private double nbPartsFoyer = 0;</span>

    // decote
<span class="fc" id="L38">    private double decote = 0;</span>
    // impôt des déclarants
<span class="fc" id="L40">    private double montantImpotDeclarant = 0;</span>
    // impôt du foyer fiscal
<span class="fc" id="L42">    private double montantImpotFoyer = 0;</span>
<span class="fc" id="L43">    private double montantImpotAvantDecote = 0;</span>
    // parent isolé
<span class="fc" id="L45">    private boolean estParentIsole = false;</span>
    // Contribution exceptionnelle sur les hauts revenus
<span class="fc" id="L47">    private double montantContributionExceptionnelle = 0;</span>

    // Getters pour adapter le code legacy pour les tests unitaires

    public double getRevenuReference() {
<span class="fc" id="L52">        return revenuFiscalReference;</span>
    }

    public double getDecote() {
<span class="fc" id="L56">        return decote;</span>
    }


    public double getAbattement() {
<span class="fc" id="L61">        return abattement;</span>
    }

    public double getNbParts() {
<span class="fc" id="L65">        return nbPartsFoyer;</span>
    }

    public double getImpotAvantDecote() {
<span class="fc" id="L69">        return montantImpotAvantDecote;</span>
    }

    public double getImpotNet() {
<span class="fc" id="L73">        return montantImpotFoyer;</span>
    }

    public int getRevenuNetDeclatant1() {
<span class="nc" id="L77">        return revenuNetDeclarant1;</span>
    }

    public int getRevenuNetDeclatant2() {
<span class="nc" id="L81">        return revenuNetDeclarant2;</span>
    }

    public double getMontantContributionExceptionnelle() {
<span class="fc" id="L85">        return montantContributionExceptionnelle;</span>
    }

    private void initialiserVariables(
            int rev1, int rev2, int enfants, int enfantsHandicapes, boolean isolé
    ) {
<span class="fc" id="L91">        this.revenuNetDeclarant1 = rev1;</span>
<span class="fc" id="L92">        this.revenuNetDeclarant2 = rev2;</span>
<span class="fc" id="L93">        this.nbEnfants = enfants;</span>
<span class="fc" id="L94">        this.nbEnfantsHandicapes = enfantsHandicapes;</span>
<span class="fc" id="L95">        this.estParentIsole = isolé;</span>
<span class="fc" id="L96">    }</span>


    // Fonction de calcul de l'impôt sur le revenu net en France en 2024 sur les revenu 2023

    public int calculImpot(
            int paramRevenuNetDeclarant1, int paramRevenuNetDeclarant2,
            SituationFamiliale paramSituationFamilial, int paramNbEnfants,
            int paramNbEnfantsHandicapes, boolean paramEstParentIsol
    ) {
<span class="fc" id="L106">        VerificateurDonneesFiscales.verifierDonnees(paramRevenuNetDeclarant1,</span>
                paramRevenuNetDeclarant2, paramSituationFamilial,
                paramNbEnfants, paramNbEnfantsHandicapes, paramEstParentIsol);

        // Initialisation des variables
<span class="fc" id="L111">        initialiserVariables(paramRevenuNetDeclarant1, paramRevenuNetDeclarant2,</span>
                paramNbEnfants, paramNbEnfantsHandicapes, paramEstParentIsol);

        // Abattement EXIGENCE : EXG_IMPOT_02
<span class="fc" id="L115">        this.abattement = Abattement.calculerAbattement(</span>
                paramSituationFamilial, revenuNetDeclarant1, revenuNetDeclarant2);
<span class="fc" id="L117">        this.revenuFiscalReference = Revenu.calculerRevenuFiscal(</span>
                revenuNetDeclarant1, revenuNetDeclarant2, this.abattement);

        // parts déclarants EXIG  : EXG_IMPOT_03
<span class="fc" id="L121">        nbPartsDeclarants = PartsFiscales.calculerPartsDeclarants(paramSituationFamilial);</span>
<span class="fc" id="L122">        nbPartsFoyer = PartsFiscales.calculerPartsFoyer(paramSituationFamilial, nbPartsDeclarants,</span>
            this.nbEnfants, this.nbEnfantsHandicapes, estParentIsole);

        // Contribution exceptionnelle sur les hauts revenus EXIGENCE : EXG_IMPOT_07:
<span class="fc" id="L126">        montantContributionExceptionnelle = ContributionExceptionnelle.calculer(</span>
                revenuFiscalReference, nbPartsDeclarants);

        // Calcul impôt des declarants : EXIGENCE : EXG_IMPOT_04
<span class="fc" id="L130">        montantImpotDeclarant = Impot.calculerImpotBrut(revenuFiscalReference, nbPartsDeclarants);</span>

        // Calcul impôt foyer fiscal complet : EXIGENCE : EXG_IMPOT_04
<span class="fc" id="L133">        montantImpotFoyer = Impot.calculerImpotBrut(revenuFiscalReference, nbPartsFoyer);</span>

        // Vérification de la baisse d'impôt autorisée : EXIGENCE : EXG_IMPOT_05
        // baisse impot
<span class="fc" id="L137">        montantImpotAvantDecote = PlafonneurAvantageFiscal.appliquerPlafond(</span>
                montantImpotDeclarant, montantImpotFoyer, nbPartsDeclarants, nbPartsFoyer );

        // Calcul de la decote : EXIGENCE : EXG_IMPOT_06
<span class="fc" id="L141">        decote = Decote.calculer(montantImpotFoyer, nbPartsDeclarants);</span>

<span class="fc" id="L143">        montantImpotFoyer = Impot.calculerImpotNet(</span>
            montantImpotAvantDecote, montantContributionExceptionnelle, decote );

<span class="fc" id="L146">        afficherInformationsFinales(paramSituationFamilial);</span>
<span class="fc" id="L147">        return  (int) montantImpotFoyer;</span>
    }

    private void afficherInformationsFinales(SituationFamiliale situation) {
<span class="fc" id="L151">        System.out.println(&quot;--------------------------------------------------&quot;);</span>
<span class="fc" id="L152">        System.out.println(&quot;Revenu net declarant1 : &quot; + revenuNetDeclarant1);</span>
<span class="fc" id="L153">        System.out.println(&quot;Revenu net declarant2 : &quot; + revenuNetDeclarant2);</span>
<span class="fc" id="L154">        System.out.println(&quot;Situation familiale : &quot; + situation.name());</span>
<span class="fc" id="L155">        System.out.println(&quot;Abattement : &quot; + abattement);</span>
<span class="fc" id="L156">        System.out.println(&quot;Revenu fiscal de référence : &quot; + revenuFiscalReference);</span>
<span class="fc" id="L157">        System.out.println(&quot;Parts déclarants : &quot; + nbPartsDeclarants);</span>
<span class="fc" id="L158">        System.out.println(&quot;Parts foyer fiscal : &quot; + nbPartsFoyer);</span>
<span class="fc" id="L159">        System.out.println(&quot;Impôt brut déclarants : &quot; + montantImpotDeclarant);</span>
<span class="fc" id="L160">        System.out.println(&quot;Impôt brut foyer : &quot; + montantImpotFoyer);</span>
<span class="fc" id="L161">        System.out.println(&quot;Impôt plafonné (avant décote) : &quot; + montantImpotAvantDecote);</span>
<span class="fc" id="L162">        System.out.println(&quot;Décote : &quot; + decote);</span>
<span class="fc" id="L163">        System.out.println(&quot;Contribution exceptionnelle : &quot; + montantContributionExceptionnelle);</span>
<span class="fc" id="L164">        System.out.println(&quot;Impôt net final : &quot; + montantImpotFoyer);</span>
<span class="fc" id="L165">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>